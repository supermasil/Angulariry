
<div class="mx-auto" style="width: 99%;">
  <mat-accordion *ngIf='trackings.length > 0'>
    <mat-expansion-panel *ngFor='let tracking of trackings'>
      <mat-expansion-panel-header class={{getHeaderColor(tracking.generalInfo.status)}}>
        <mat-panel-title>
          <div><b>{{tracking.trackingNumber}} </b> <span class="badge" [style.backgroundColor]="getBadgeColor(tracking.generalInfo.status)" style="color: white;">{{tracking.generalInfo.status}}</span></div>
          <div class="ml-auto">{{formatDateTime(tracking.updatedAt)}}</div>
        </mat-panel-title>
      </mat-expansion-panel-header>

      <ng-template matExpansionPanelContent>
        <div class="row image-container">
          <ng-container *ngFor="let url of tracking.generalInfo.filePaths; let indexOfelement=index;">
            <div class='image-preview d-inline-flex float-left' data-toggle="modal" [attr.data-target]="'#modal-'+ indexOfelement">
              <img [src]="url">
            </div>
            <!-- Modal -->
            <div class="modal fade" id="modal-{{indexOfelement}}" tabindex="-1" role="dialog" data-backdrop="false">
              <div class="modal-dialog modal-xl" role="document">
                <div class="modal-content">
                  <div class="modal-body">
                    <img [src]="url" class="w-100">
                  </div>
                  <div class="modal-footer">
                    <button type="button" mat-raised-button color='basic' data-dismiss="modal">Close</button>
                  </div>
                </div>
              </div>
            </div>
          </ng-container>
        </div>
        <hr>
        <div class="row">
          <div class="col-lg-6">
            <span class="d-block mat-h4"><b>Origin</b> {{tracking.generalInfo.origin}}</span>
              <span class="d-block mat-h4"><b>Destination</b> {{tracking.generalInfo.destination}}</span>
              <span class="d-block mat-h4" *ngIf="tracking.generalInfo.sender"><b>Sender</b> {{tracking.generalInfo.sender}}</span>
              <span class="d-block mat-h4" *ngIf="tracking.generalInfo.recipient"><b>Recipient</b> {{tracking.generalInfo.recipient.name}} <a rel="noopener noreferrer" target="_blank" href="{{tracking.generalInfo.recipient.address.addressUrl}}">{{tracking.generalInfo.recipient.address.address}} {{tracking.generalInfo.recipient.address.addressLineTwo}}</a></span>
            <div class="scroll-box">
              <span class="d-block mat-h4" style="white-space: pre-line;">{{tracking.generalInfo.content}}</span>
            </div>
          </div>
          <div class="col-lg-6 mt-xs-2 mt-md-0">
            <ng-container *ngIf="true">
              <form [formGroup]='commentForm' #f='ngForm' (submit)='onCommentSubmit(tracking._id, tracking.trackingNumber, comment.value)'>
                <div class="d-flex">
                  <mat-form-field appearance="outline" class="mr-2">
                    <mat-label>Comment</mat-label>
                    <textarea
                      #comment
                      rows="2"
                      matInput
                      formControlName='commentContent'
                      cdkTextareaAutosize>
                    </textarea>
                  </mat-form-field>
                  <button
                    mat-icon-button
                    color='primary'
                    type='submit'
                    class="mt-2 d-inline">
                    <mat-icon>send</mat-icon>
                  </button>
                </div>
              </form>
            </ng-container>

            <div class="scroll-box">
              <ng-container *ngFor="let comment of tracking.generalInfo.comments">
                <div class="mat-body-strong">{{comment?.creatorName}}   <span class="dimmed-text">{{formatDateTime(comment?.updatedAt)}}</span></div>

                <div>{{comment?.content}}</div>
                <hr>
              </ng-container>
            </div>
          </div>
        </div>
      </ng-template>

      <mat-action-row>
        <div>
          <a mat-button color='primary' [routerLink]="['/trackings/edit', tracking.trackingNumber]" >Edit</a>
          <button mat-button color='warn' (click)='onDelete(tracking._id)'>Delete</button>
        </div>
      </mat-action-row>
    </mat-expansion-panel>
  </mat-accordion>
  <mat-paginator *ngIf='trackings.length > 0'[length]='totalTrackings' [(pageSize)]='trackingsPerPage' [pageSizeOptions]='pageSizeOptions' (page)='pageDataChange($event)'></mat-paginator>
</div>

