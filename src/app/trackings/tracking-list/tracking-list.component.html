<mat-card>
  <form [formGroup]='' class="search-bar">
    <mat-form-field appearance="outline">
      <mat-label>Search here</mat-label>
      <input matInput placeholder="Search anything, really">
    </mat-form-field>
  </form>
</mat-card>
<mat-spinner *ngIf='isLoading'></mat-spinner>
<br>
<mat-accordion multi='true' *ngIf='trackings.length > 0 && !isLoading'>
  <mat-expansion-panel *ngFor='let tracking of trackings'>

    <mat-expansion-panel-header class={{getHeaderColor(tracking.status)}}>
      <mat-panel-title class="text-white">
        {{ tracking.trackingNumber }} {{tracking.carrier}} {{tracking.status}}
      </mat-panel-title>
    </mat-expansion-panel-header>
    <div>
      <ng-template matExpansionPanelContent>
        <div class='tracking-image mt-3' *ngIf="tracking.imagePath">
          <img [src]='tracking.imagePath' (click)="openDialog(tracking.imagePath)">
        </div>
        <hr>
        <div class="row">
          <div class="col-md-6">
            <div class="mat-title">Note</div>
            <div class="overflow-auto note">
              <p>{{ tracking.content }}</p>
            </div>
          </div>
          <div class="col-md-6">

            <div class="mat-title mt-3 mt-md-0">Timeline</div>
            <!-- <div class="mat-title">Timeline</div> -->
            <div class="overflow-auto timeline">
              <ng-container *ngFor="let point of tracking.timeline">
                <div class="row">
                  <div class="col-md">
                    <div class="mat-body-strong">{{point.timestamp}}</div>
                    {{point.user}}
                  </div>
                  <div class="col-md">
                    {{point.action}}
                  </div>
                </div>
                <hr>
              </ng-container>
            </div>
          </div>
        </div>
      </ng-template>
    </div>


    <mat-action-row>
      <div *ngIf="userIsAuthenticated && userId === tracking.creator;">
        <a mat-button color='primary' [routerLink]="['/edit', tracking._id]" >Edit</a>
        <button mat-button color='warn' (click)='onDelete(tracking._id)'>Delete</button>
      </div>

      <!-- <div *ngIf="userIsAuthenticated && userId !== tracking.creator">
        <div *ngIf="!subscribedTrackings.includes(tracking._id); else subscribed">
          <button mat-raised-button color='primary' (click)='onSubscribe(tracking._id)'>Subscribe</button>
        </div>

        <ng-template #subscribed>
          <button mat-raised-button color='warn' (click)='onUnSubscribe(tracking._id)'>Unsubscribe</button>
        </ng-template>
      </div> -->

    </mat-action-row>
  </mat-expansion-panel>
</mat-accordion>

<mat-paginator [length]='totalTrackings' [pageSize]='trackingsPerPage' [pageSizeOptions]='pageSizeOptions' (page)='onChangedPage($event)'></mat-paginator>
<p class='info-text mat-body-1' *ngIf='trackings.length <= 0 && !isLoading'>No trackings added yet</p>
